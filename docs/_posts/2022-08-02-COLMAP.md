---
date: 2022-08-02
layout: post
title: What is the COLMAP?
subtitle: "Tech blog: COLMAP"
description: How to process multiple images
image: https://user-images.githubusercontent.com/55485826/182304032-f6b66d8f-2fba-4ca0-a332-b841bfaa3891.png
category: Reconstruction
tags:
  - Vision
  - 3D reconstruction
  - Graphics
author: jgnooo
---

이번 주에 RebuilderAI R&D팀에서 소개할 내용은 **COLMAP** 입니다. 기술 소개에 앞서, 전체적인 3D 모델 변환 Pipeline에 대해 소개하도록 하겠습니다.
![3d_recon_pipeline](https://user-images.githubusercontent.com/55485826/182308345-dcd4f611-e3e1-4965-a550-5cbf25c20f73.png)
    _그림 1) 3D 변환 파이프라인_

360도로 촬영한 동영상 혹은 이미지를 입력하면, AI 모델에 들어가기 전에 **카메라 정보**를 먼저 계산해야합니다. 카메라 정보를 계산한 후에, 이미지와 이미지에 대응하는 카메라 정보는 AI 모델로 입력되고 3D로 변환됩니다.
3D로 복원하기 위해서는 각 이미지에 대한 카메라 정보가 필요하고, 이 때 필요한 모듈이 **COLMAP** 입니다.

COLMAP은 여러 시점에서 촬영한 이미지로부터 3D를 복원할 때 많이 사용되고 있습니다. COLMAP에 이미지들을 넣게 되면 카메라 정보를 계산할 수 있고, 더 나아가 3D로 복원된 결과도 얻을 수 있는 도구입니다.

오늘은 3D 변환 파이프라인 중 하나인 카메라 정보 계산을 위해 사용하고 있는 COLMAP에 대해 알아보겠습니다.

## Structure-from-Motion
---
![SfM](https://user-images.githubusercontent.com/55485826/182309496-0e29df29-6d4c-4de2-b7e6-a0085d679943.png)
    _그림 2) Structure-from-Motion pipeline_

COLMAP은 **Structure-from-Motion**이라는 기술을 프로그램으로 구현한 것 입니다.

Structure-from-Motion(SfM)은 한 Scene에 대해 여러 시점에서 촬영한 이미지들로부터 3차원 구조를 복원하는 시스템입니다. SfM은 기본적으로 크게 3단계로 구성됩니다.
> 1. 피처(Feature) 검출
> 2. 피처 매칭
> 3. Structure / Motion 복원

### 피처 검출
---
![feature](https://user-images.githubusercontent.com/55485826/182315713-cec5aa14-4198-4a87-a7c0-8589f5fa628d.jpg)
    _그림 3) Feature 예시_

피처(Feature)란 이미지를 설명할 수 있는 특징적인 부분을 말합니다. 그림 3)에서 처럼, 사람 얼굴에서 눈이나 머리카락 같이 주변과 비교해서 변화가 큰 부분이나 두드러지게 특징적인 부분이 피처라고 볼 수 있습니다. 반대로 사람의 어깨, 볼과 같이 인접한 부분과 비교해서 변화가 적거나 두드러지지 않는 부분은 피처가 적은 부분입니다.
SfM 시스템은 검출한 피처로부터 시작되기 때문에 피처가 적은 이미지들이 입력되면 제대로 동작하지 않게 됩니다. 이와 같은 이유로 3D 변환을 위해 동영상이나 사진을 촬영할 때 밋밋하거나 두드러진 특징이 보이지 않는 이미지를 입력하면 변환에 실패하거나 제대로된 결과를 얻을 수 없게 됩니다(그림 4).
![feature2](https://user-images.githubusercontent.com/55485826/182317160-7c6268b4-fc20-4cb3-9dc9-87c938838d75.png)
    _그림 4) Feature가 적은 이미지 예시_

### 피처 매칭
---
각 이미지에서 피처를 검출한 후에는 각 이미지들의 피처를 매칭하는 과정을 거치게 됩니다. 피처 매칭이란 한 이미지와 다른 이미지의 피처가 매칭되는 부분을 확인하는 것 입니다(그림 5).
![feature_matching](https://user-images.githubusercontent.com/55485826/182317881-aea66759-3915-43f3-ae2f-89139a17d7e7.jpg)
    _그림 5) Feature matching 예시_

### Structure / Motion 복원
--- 
피처 매칭 과정이 완료된 후에, 매칭된 점들을 활용해 RANSAC과 같은 알고리즘을 사용해 Structure / Motion 등을 계산합니다. _(알고리즘의 자세한 내용은 다음 기회에 설명하도록 하겠습니다.)_

COLMAP(SfM)은 위에서 소개한 3가지 단계를 통해 카메라 정보를 계산하거나 3차원 구조를 복원할 수 있습니다. 이렇게 획득한 3차원 정보는 오차가 발생할 수 있어 추가적인 작업(e.g. Bundle adjustment)을 통해 보다 정확한 정보를 계산합니다. 이 과정을 통해 획득한 카메라 정보와 여러 시점의 이미지들은 AI 모델의 입력으로 사용되고, 최종적으로 3D 모델로 변환됩니다.